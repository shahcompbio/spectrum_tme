---
title: "MSK SPECTRUM data freeze: major cell type embeddings"
author: "Florian Uhlitz"
date: "`r Sys.Date()`"
output: 
  html_document: 
    df_print: kable
    number_sections: yes
    toc: yes
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = F)

```

```{r chunk_010}

library(magrittr)
library(tidyverse)
library(Seurat)
library(readxl)
library(cowplot)
library(colorblindr)
library(viridis)
library(magick, lib.loc = "/home/uhlitzf/miniconda3/lib/R/library")
library(ggpubr)

theme_cowplot2 <- function(...) {
  theme_cowplot(font_size = 16, font_family = "sans", ...) %+replace%
    theme(strip.background = element_blank(),
          panel.background = element_rect(fill = "transparent", color = NA),
          plot.background = element_rect(fill = "transparent", color = NA),
          panel.border = element_blank())
}
theme_set(theme_cowplot2())

remove_xaxis <- theme(axis.title.x = element_blank(),
                      axis.text.x = element_blank(),
                      axis.ticks.x = element_blank(),
                      axis.line.x = element_blank())

remove_guides <- guides(color = F, fill = F, shape = F, alpha = F)

```

```{r chunk_020}

## load global vars: 
source("_src/global_vars.R")

# meta_tbl
# clrs
# markers_v6
# markers_v6_super
# cell_type_super_lookup

```

```{r chunk_040}

## load full seurat objects with expression data
# seu_obj_tc <- read_rds("/work/shah/uhlitzf/data/SPECTRUM/freeze/v5/T.cell_processed_filtered_sub.rds")
# seu_obj_cc <- read_rds(paste0("/work/shah/uhlitzf/data/SPECTRUM/freeze/v5/Ovarian.cancer.cell_processed_filtered.rds"))
seu_obj_cc <- read_rds("/work/shah/uhlitzf/data/SPECTRUM/freeze/v6/Ovarian.cancer.cell_processed_filtered.rds")
markers_tbl <- read_tsv("/work/shah/uhlitzf/data/SPECTRUM/freeze/v6/Ovarian.cancer.cell_highqc_markers_02.tsv")


plot_data <- FetchData(seu_obj_cc, c("sample", grep("^HLA", rownames(seu_obj_cc), value = T))) %>%
  as_tibble() %>% 
  gather(gene, value, -sample) %>% 
  left_join(meta_tbl, by = "sample") %>% 
  group_by(consensus_signature, gene, sample, patient_id_short) %>% 
  summarise(value = median(value))

ggplot(plot_data) + 
  geom_tile(aes(sample, gene, fill = value)) +
  scale_fill_viridis() +
  facet_grid(~consensus_signature, scales = "free_x", space = "free_x")

```

```{r chunk_050}

plot_data <- cbind(cell_id = colnames(seu_obj_cc), FetchData(seu_obj_cc, c("umapharmony_1", "umapharmony_2", "umappca_1", "umappca_2", "RNA_snn_res.0.2", "sample", "cluster_label", grep("pathway", colnames(seu_obj_cc@meta.data), value = T)))) %>% 
  as_tibble() %>% 
  left_join(meta_tbl, by = "sample") %>% 
  filter(!is.na(consensus_signature))

base_umap <- ggplot(plot_data) +
  coord_fixed() +
  NoAxes() +
  theme(legend.position = c(0, 1),
        legend.justification = c("left", "top"),
        legend.box.just = "left",
        legend.margin = margin(1, 1, 1, 1),
        #panel.border = element_rect(linetype = 1, color = "black", size = 1),
        legend.text = element_text(size = 14, margin = margin(0, 10, 0, 0)),
        legend.spacing.x = unit(0, "npc"), 
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "plain", size = 22))

arrow <- arrow(angle = 20, type = "closed", length = unit(0.1, "npc"))
umap_coord_anno <- ggplot(tibble(group = c("UMAP1", "UMAP2"),
                                 x = c(0, 0), xend = c(1, 0),
                                 y = c(0, 0), yend = c(0, 1),
                                 lx = c(0.5, -0.15), ly = c(-0.15, 0.5),
                                 angle = c(0, 90))) +
  geom_segment(aes(x, y, xend = xend, yend = yend, group = group),
               arrow = arrow, size = 1, lineend = "round") +
  geom_text(aes(lx, ly, label = group, angle = angle), size = 4) +
  theme_void() +
  coord_fixed(xlim = c(-0.3, 1), ylim = c(-0.3, 1))

add_umap_coord <- function(gg_obj) {
  p <- ggdraw() + 
    draw_plot(gg_obj, x = 0, y = 0, width = 1, height = 1) +
    draw_plot(umap_coord_anno, x = -0.015, y = -0.02, width = 0.2, height = 0.2)
  return(p)
}

```

```{r chunk_060}

pt.size <- 0.1
pt.size.mini <- 0.01
pt.alpha <- 0.05
pt.alpha.mini <- 0.02

median_tbl <- plot_data %>%
  group_by(patient_id_short) %>% 
  summarise(umappca_1 = median(umappca_1), 
            umappca_2 = median(umappca_2))

umap_pca_mutsig <- base_umap + 
  geom_point(aes(umappca_1, umappca_2, color = consensus_signature), 
             size = pt.size, alpha = pt.alpha) +
  geom_text(aes(umappca_1, umappca_2, label = patient_id_short), data = median_tbl) + 
  scale_color_manual(values = clrs$consensus_signature) +
  guides(color = guide_legend(override.aes = list(size = 4, alpha = 1),
                              ncol = 1, 
                              label.position = "right")) +
  labs(title = "Mutational signature")

umap_mutsig <- base_umap + 
  geom_point(aes(umapharmony_1, umapharmony_2, color = consensus_signature), 
             size = pt.size, alpha = pt.alpha) +
  scale_color_manual(values = clrs$consensus_signature) +
  guides(color = guide_legend(override.aes = list(size = 4, alpha = 1),
                              ncol = 1, 
                              label.position = "right")) +
  guides(color = F) + 
  labs(title = "")

umap_pca_cluster <- base_umap + 
  geom_point(aes(umappca_1, umappca_2, color = cluster_label), 
             size = pt.size, alpha = pt.alpha) +
  geom_text(aes(umappca_1, umappca_2, label = patient_id_short), data = median_tbl) + 
  scale_color_manual(values = clrs$cluster_label$Ovarian.cancer.cell) +
  guides(color = guide_legend(override.aes = list(size = 4, alpha = 1),
                              ncol = 1, 
                              label.position = "right")) +
  labs(title = "Cluster")

umap_cluster <- base_umap + 
  geom_point(aes(umapharmony_1, umapharmony_2, color = cluster_label), 
             size = pt.size, alpha = pt.alpha) +
  scale_color_manual(values = clrs$cluster_label$Ovarian.cancer.cell) +
  guides(color = guide_legend(override.aes = list(size = 4, alpha = 1),
                              ncol = 1, 
                              label.position = "right")) +
  guides(color = F) + 
  labs(title = "")

cluster_legend <- cowplot::get_legend(umap_pca_cluster)

umap_pca_jak_stat <- base_umap + 
  # geom_point(aes(umappca_1, umappca_2), color = "grey80",
  #            size = pt.size, alpha = pt.alpha, 
  #            data = filter(plot_data, JAK.STAT.pathway <= 0)) +
  geom_point(aes(umappca_1, umappca_2, color = JAK.STAT.pathway), 
             size = pt.size, alpha = pt.alpha, 
             data = mutate(plot_data, JAK.STAT.pathway = ifelse(JAK.STAT.pathway > 4, 4, JAK.STAT.pathway))) +
  geom_text(aes(umappca_1, umappca_2, label = patient_id_short), data = median_tbl) + 
  scale_color_gradientn(colours = viridis(9), breaks = c(0, 2, 4), limits = c(min(plot_data$JAK.STAT.pathway), 4), labels = c(0, 2, "≥4")) +
  labs(title = "JAK-STAT signaling")

umap_jak_stat <- base_umap + 
  # geom_point(aes(umapharmony_1, umapharmony_2), color = "grey80",
  #            size = pt.size, alpha = pt.alpha, 
  #            data = filter(plot_data, JAK.STAT.pathway <= 0)) +
  geom_point(aes(umapharmony_1, umapharmony_2, color = JAK.STAT.pathway), 
             size = pt.size, alpha = pt.alpha, 
             data = mutate(plot_data, JAK.STAT.pathway = ifelse(JAK.STAT.pathway > 4, 4, JAK.STAT.pathway))) +
  scale_color_gradientn(colours = viridis(9), breaks = c(0, 2, 4), limits = c(min(plot_data$JAK.STAT.pathway), 4), labels = c(0, 2, "≥4")) +
  guides(color = F) + 
  labs(title = "")


```

```{r chunk_062, fig.width=12, fig.height=8}


```

```{r chunk_063, fig.width=20, fig.height=5}

cluster_comp <- plot_data %>% 
  mutate(sort_short_x = str_replace_all(sort_short, "U", "CD45-")) %>% 
  group_by(cluster_label, consensus_signature, sample, sort_short_x, tumor_supersite, therapy) %>% 
  tally %>% 
  group_by(consensus_signature, sample, sort_short_x, tumor_supersite, therapy) %>% 
  mutate(nrel = n/sum(n)*100) %>% 
  ungroup %>% 
  arrange(cluster_label != "Secretory.cell.6", -nrel) %>% 
  mutate(sample = ordered(sample, levels = unique(sample))) %>% 
  mutate(cell_type = "Ovarian.cancer.cell")

cluster_comp_rank <- cluster_comp %>% 
  distinct(sample, .keep_all = T) %>% 
  filter(sort_short_x == "CD45-") %>% 
  mutate(sample = ordered(sample, levels = unique(as.character(sample)))) %>% 
  mutate(sample_rank = scales::rescale(as.numeric(sample), c(-1, 1)))

p1 <- comp_plot_wrapper(cluster_comp, "CD45-", "n", x = "sample", fill = "cluster_label", super_type = "Ovarian.cancer.cell")
p2 <- comp_plot_wrapper(cluster_comp, "CD45-", "nrel", x = "sample", fill = "cluster_label", super_type = "Ovarian.cancer.cell")
p3 <- comp_label_boxplot(cluster_comp_rank, x = "consensus_signature", y = "sample_rank", clr = "consensus_signature", cts = "CD45-")


pcomp_grid_p_full <- plot_grid(p1, p2, p3,
                               ncol = 1, align = "v",
                               rel_heights = c(0.25, 0.25, 0.4))


```

```{r chunk_065, fig.width=20, fig.height=5}

# cluster_comp <- plot_data %>% 
#   group_by(cluster_label, consensus_signature) %>% 
#   tally %>% 
#   group_by(consensus_signature) %>% 
#   mutate(total_cs = sum(n)) %>% 
#   group_by(cluster_label) %>% 
#   # filter(total_cs > 10000) %>% 
#   mutate(total_cl = sum(n),
#          nnorm = n/total_cs,
#          nrel = n/sum(n),
#          nrelnorm = nnorm/sum(nnorm)) %>% 
#   gather(key, value, -cluster_label, -consensus_signature, -total_cs, -total_cl)
# 
# cluster_comp %>% 
#   filter(key %in% c("nrelnorm"),
#          total_cl > 10000) %>% 
#   ggplot() +
#   geom_bar(aes(cluster_label, value, fill = consensus_signature), 
#            stat = "identity", position = "dodge") +
#   facet_wrap(~key, scales = "free_x") + 
#   scale_fill_manual(values = clrs$consensus_signature) +
#   theme(axis.ticks.y = element_blank(),
#         axis.title.x = element_text(),
#         axis.text.y = element_text(hjust = 1)) +
#   coord_flip()

```

```{r chunk_070, fig.width=20, fig.height=5}

cancer_grid_pca <- ggdraw() +
  draw_plot(add_umap_coord(umap_pca_mutsig), 
            x = 0, y = 0, width = 0.25, height = 1) +
  draw_plot(add_umap_coord(umap_pca_cluster + guides(color = F)), 
            x = 0.25, y = 0, width = 0.25, height = 1) +
  draw_grob(cluster_legend, x = 0.5, y = -0.15, height = 1) +
  draw_plot(add_umap_coord(umap_pca_jak_stat), x = 0.7, y = 0, width = 0.25, height = 1)

cancer_grid <- ggdraw() +
  draw_plot(add_umap_coord(umap_mutsig), 
            x = 0, y = 0, width = 0.25, height = 1) +
  draw_plot(add_umap_coord(umap_cluster + guides(color = F)), 
            x = 0.25, y = 0, width = 0.25, height = 1) +
  draw_plot(pcomp_grid_p_full, 
            x = 0.5, y = 0, width = 0.18, height = 1) +
  draw_plot(add_umap_coord(umap_jak_stat), x = 0.7, y = 0, width = 0.25, height = 1)

cancer_grid_pca
cancer_grid

# ggsave("_fig/003_cancer_cell/003_umap_grid.pdf", cancer_grid, width = 20, height = 5)
ggsave("_fig/003_cancer_cell/003_umap_grid_pca.png", cancer_grid_pca, width = 20, height = 5)
ggsave("_fig/003_cancer_cell/003_umap_grid.png", cancer_grid, width = 20, height = 5)

```


```{r chunk_080}

# ## downsample objects for exploration
# # set.seed(123)
# # seu_obj_tc_sub <- subset(seu_obj_tc, cells = sample(colnames(seu_obj_tc), 10000))
# # seu_obj_cc_sub <- subset(seu_obj_cc, cells = sample(colnames(seu_obj_cc), 10000))
# seu_obj_cc_sub <- seu_obj_cc
# seu_obj_tc_sub <- seu_obj_tc
# 
# tc_data <- cbind(cell_id = colnames(seu_obj_tc_sub), FetchData(seu_obj_tc_sub, c("sample", "cluster_label", names(signature_modules), "CD8.ISG"))) %>% 
#   filter(str_detect(cluster_label, "CD8")) %>% 
#   as_tibble %>% 
#   rename(isabl_id = sample) %>% 
#   gather(module, tc_score, -cell_id, -isabl_id, -cluster_label) %>% 
#   left_join(meta_tbl, by = "isabl_id")
# 
# patient_tc_ranks <- tc_data %>% 
#   filter(sort_short == "CD45+", therapy == "pre-Rx") %>% 
#   group_by(sample_id, module) %>% 
#   summarise(median_tc_score = median(tc_score)) %>% 
#   ungroup

```

# Differential expression in cancer cells

Are there certain pathways activated in cancer cells...

* of patients with high vs low dysfunctional T cells?
* of HRD vs FBI patients

```{r chunk_090}

# progeny_tbl <- progeny(as.matrix(seu_obj_cc_sub@assays$RNA@data[VariableFeatures(seu_obj_cc_sub),])) %>% 
#   as_tibble(rownames = "cell_id") %>% 
#   gather(pathway, score, -cell_id)
# 
# plot_data <- cbind(cell_id = colnames(seu_obj_cc_sub), FetchData(seu_obj_cc_sub, c("umapharmony_1", "umapharmony_2", "sample", "RNA_snn_res.0.2", "nFeature_RNA", "percent.mt"))) %>% 
#   as_tibble() %>% 
#   rename(isabl_id = sample) %>% 
#   left_join(meta_tbl, by = "isabl_id") %>% 
#   filter(sort_short == "CD45-", therapy == "pre-Rx") %>% 
#   left_join(select(signature_tbl, patient_id, consensus_signature), by = "patient_id") %>% 
#   left_join(progeny_tbl, by = "cell_id")
# 
# patient_pw_ranks <- plot_data %>% 
#   group_by(pathway, patient_id) %>% 
#   summarise(median_score = median(score)) %>% 
#   ungroup() %>% 
#   arrange(pathway, median_score) %>% 
#   # group_by(pathway) %>% 
#   mutate(pw_rank = as.factor(row_number(median_score))) %>% 
#   ungroup()
# 
# patient_pw_ranks_site <- plot_data %>% 
#   group_by(pathway, sample_id) %>% 
#   summarise(median_score_site = median(score)) %>% 
#   ungroup() %>% 
#   arrange(pathway, median_score_site) %>% 
#   # group_by(pathway) %>% 
#   mutate(pw_rank_site = as.factor(row_number(median_score_site))) %>% 
#   ungroup()
# 
# plot_data_ranked <- plot_data %>% 
#   left_join(patient_pw_ranks, by = c("pathway", "patient_id")) %>% 
#   left_join(patient_pw_ranks_site, by = c("pathway", "sample_id"))

```

## pathway scores across cancer cell clusters

```{r chunk_100, fig.width=10, fig.height=5}

# p1 <- ggplot() + 
#   geom_point(aes(umapharmony_1, umapharmony_2, color = RNA_snn_res.0.2), size = 0.01, 
#              data = distinct(plot_data, umapharmony_1, umapharmony_2, RNA_snn_res.0.2)) +
#   theme_void() +
#   guides(color = guide_legend(override.aes = list(size = 2))) +
#   coord_fixed()
# 
# p2 <- ggplot() +
#   geom_bar(aes(RNA_snn_res.0.2, n, fill = RNA_snn_res.0.2), stat = "identity",
#            data = distinct(plot_data, umapharmony_1, umapharmony_2, RNA_snn_res.0.2) %>% 
#              group_by(RNA_snn_res.0.2) %>% tally) +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
#   scale_y_log10() + 
#   guides(fill = F)
# 
# p3 <- ggplot() + 
#   geom_point(aes(umapharmony_1, umapharmony_2), size = 0.01, color = "grey80",
#              data = distinct(plot_data, umapharmony_1, umapharmony_2)) +
#   geom_point(aes(umapharmony_1, umapharmony_2, color = RNA_snn_res.0.2), size = 0.01, alpha = 0.1,
#              data = distinct(plot_data, umapharmony_1, umapharmony_2, RNA_snn_res.0.2)) +
#   facet_wrap(~RNA_snn_res.0.2, ncol = 8) + 
#   theme_void() +
#   guides(color = guide_legend(override.aes = list(size = 2))) +
#   coord_fixed()
# 
# plot_grid(p1, p2, nrow = 1)
# p3

```

```{r chunk_110, fig.width=15, fig.height=10}

# ggplot() + 
#   geom_point(aes(umapharmony_1, umapharmony_2), size = 0.1, color = "grey80",
#              data = filter(plot_data, score <= 0)) +
#   geom_point(aes(umapharmony_1, umapharmony_2, color = score), size = 0.1, 
#              data = filter(plot_data, score > 0)) +
#   facet_wrap(~pathway) + 
#   scale_color_gradientn(colors = viridis(9)) + 
#   theme_void()
# 
# ggplot() + 
#   geom_boxplot(aes(RNA_snn_res.0.2, score, color = RNA_snn_res.0.2), 
#                data = plot_data) +
#   facet_wrap(~pathway, scales = "free") + 
#   # scale_color_gradientn(colors = viridis(9)) + 
#   theme_void() +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
# 
# select(markers_tbl, cluster, gene) %>% 
#   group_by(cluster) %>% 
#   mutate(rank = row_number(cluster)) %>% 
#   slice(1:20) %>% 
#   spread(cluster, gene) %>% 
#   knitr::kable()

```

## pathway scores across tumor sites

```{r chunk_120, fig.width=15, fig.height=10}

# ggplot() + 
#   geom_boxplot(aes(tumor_supersite, score, color = tumor_supersite),
#                data = plot_data_ranked) +
#   facet_wrap(~pathway, scales = "free_y") + 
#   scale_color_manual(values = clrs$tumor_supersite) + 
#   theme_void()
# 
# ggplot() + 
#   geom_boxplot(aes(pw_rank_site, score, color = tumor_supersite, group = isabl_id), 
#                data = plot_data_ranked) +
#   facet_wrap(~pathway, scales = "free") + 
#   scale_color_manual(values = clrs$tumor_supersite) + 
#   theme_void()


```

## pathway scores across mutational signatures

```{r chunk_130, fig.width=15, fig.height=10}

# ggplot() + 
#   geom_boxplot(aes(consensus_signature, score, color = consensus_signature), 
#                data = plot_data) +
#   facet_wrap(~pathway, scales = "free_y") + 
#   scale_color_manual(values = clrs$consensus_signature) + 
#   theme_void()
# 
# ggplot(plot_data_ranked) + 
#   geom_boxplot(aes(pw_rank, score, color = consensus_signature, group = patient_id)) +
#   facet_wrap(~pathway, scales = "free") + 
#   scale_color_manual(values = clrs$consensus_signature) + 
#   scale_x_discrete(breaks = arrange(distinct(plot_data_ranked, pw_rank, patient_id_short), pw_rank)$pw_rank,
#                      labels = arrange(distinct(plot_data_ranked, pw_rank, patient_id_short), pw_rank)$patient_id_short) +
#   theme_void() +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

```

## correlation of pathway scores and T cell scores

```{r chunk_140, fig.width=18, fig.height=10}

# tc_cc_cor_tbl <- patient_pw_ranks_site %>% 
#   left_join(patient_tc_ranks, by = "sample_id") %>% 
#   left_join(distinct(meta_tbl, patient_id, sample_id, tumor_supersite), 
#             by = "sample_id") %>% 
#   left_join(select(signature_tbl, patient_id, consensus_signature), 
#             by = "patient_id") %>% 
#   na.omit()
# 
# ggplot(tc_cc_cor_tbl) +
#   geom_point(aes(median_tc_score, median_score_site, color = tumor_supersite),
#              size = 0.1) +
#   facet_grid(module~pathway) +
#   scale_color_manual(values = clrs$tumor_supersite) +
#   stat_cor(aes(median_tc_score, median_score_site), method = "spearman",
#            label.sep = "\n") +
#   geom_smooth(aes(median_tc_score, median_score_site), 
#               method = "lm", color = "black")
# 
# ggplot(tc_cc_cor_tbl) +
#   geom_point(aes(median_tc_score, median_score_site, color = consensus_signature),
#              size = 0.1) +
#   facet_grid(module~pathway) +
#   scale_color_manual(values = clrs$consensus_signature) +
#   stat_cor(aes(median_tc_score, median_score_site), method = "spearman",
#            label.sep = "\n") +
#   geom_smooth(aes(median_tc_score, median_score_site), 
#               method = "lm", color = "black")

```

# JAK-STAT signaling

```{r chunk_150, fig.width=12, fig.height=4}

# p1 <- ggplot() + 
#   geom_boxplot(aes(consensus_signature, score, color = consensus_signature), 
#                data = filter(plot_data, pathway == "JAK-STAT")) +
#   facet_wrap(~pathway, scales = "free_y") + 
#   scale_color_manual(values = clrs$consensus_signature) +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
#   guides(color = F) +
#   labs(x = "", y = "PROGENy score")
# 
# plot_data_ranked_jak_stat <- filter(plot_data_ranked, pathway == "JAK-STAT")
# 
# p2 <- ggplot(plot_data_ranked_jak_stat) + 
#   geom_boxplot(aes(pw_rank, score, color = consensus_signature, group = patient_id)) +
#   facet_wrap(~pathway, scales = "free") + 
#   scale_color_manual(values = clrs$consensus_signature) + 
#   scale_x_discrete(breaks = arrange(distinct(plot_data_ranked_jak_stat, pw_rank, patient_id_short), pw_rank)$pw_rank,
#                      labels = arrange(distinct(plot_data_ranked_jak_stat, pw_rank, patient_id_short), pw_rank)$patient_id_short) +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
#   guides(color = F) +
#   labs(x = "", y = "PROGENy score", color = "Signature")
# 
# p3 <- ggplot(filter(tc_cc_cor_tbl, pathway == "JAK-STAT", module == "CD8.ISG")) +
#   geom_point(aes(median_tc_score, median_score_site, color = consensus_signature),
#              size = 1) +
#   facet_wrap(~pathway) +
#   scale_color_manual(values = clrs$consensus_signature) +
#   stat_cor(aes(median_tc_score, median_score_site), method = "spearman",
#            label.sep = ", ") +
#   geom_smooth(aes(median_tc_score, median_score_site), 
#               method = "lm", color = "black") +
#   labs(x = "ISG module score\nin CD8 T cells", 
#        y = "JAK-STAT PROGENy\nscore in cancer cells", 
#        color = "Signature") +
#   theme(strip.text = element_blank())
# 
# plot_grid(plot_grid(p1, p2, align = "h", rel_widths = c(0.3, 0.7)), 
#           p3, rel_widths = c(0.6, 0.4))

```

# session info 

```{r chunk_999}

devtools::session_info()

```

